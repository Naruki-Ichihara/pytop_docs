"use strict";(self.webpackChunkpytop_docs=self.webpackChunkpytop_docs||[]).push([[976],{619:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>t,metadata:()=>r,toc:()=>o});var a=n(4848),i=n(8453);const t={sidebar_position:1},l="Introduction",r={id:"intro",title:"Introduction",description:"Pytop is a powerful tool designed to extend the capabilities of FEniCS for topology optimization. It provides robust tools for advanced computational design and supports multiphysics simulations. Pytop is fully compatible with MPI, allowing for efficient monitoring of parallel applications.",source:"@site/docs/intro.md",sourceDirName:".",slug:"/intro",permalink:"/pytop_docs/docs/intro",draft:!1,unlisted:!1,editUrl:"https://github.com/Naruki-Ichihara/pytop_docs/tree/main/docs/intro.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",next:{title:"Getting started",permalink:"/pytop_docs/docs/category/getting-started"}},c={},o=[{value:"General Optimization Form in Software",id:"general-optimization-form-in-software",level:2},{value:"Container",id:"container",level:2},{value:"Installation",id:"installation",level:2},{value:"Basic usage",id:"basic-usage",level:2},{value:"Import pytop",id:"import-pytop",level:3},{value:"Mesh",id:"mesh",level:3},{value:"Function space and Function",id:"function-space-and-function",level:3},{value:"Boundary Condition",id:"boundary-condition",level:3},{value:"Design variable",id:"design-variable",level:3},{value:"Problem definition",id:"problem-definition",level:3},{value:"Optimizer",id:"optimizer",level:3},{value:"Tips",id:"tips",level:2},{value:"MPI parallelization",id:"mpi-parallelization",level:3},{value:"Working with pygmsh",id:"working-with-pygmsh",level:3},{value:"Developer",id:"developer",level:2},{value:"Generate API documentation",id:"generate-api-documentation",level:3}];function d(e){const s={a:"a",annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msub:"msub",mtext:"mtext",munder:"munder",p:"p",pre:"pre",semantics:"semantics",span:"span",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.h1,{id:"introduction",children:"Introduction"}),"\n",(0,a.jsx)(s.p,{children:"Pytop is a powerful tool designed to extend the capabilities of FEniCS for topology optimization. It provides robust tools for advanced computational design and supports multiphysics simulations. Pytop is fully compatible with MPI, allowing for efficient monitoring of parallel applications."}),"\n",(0,a.jsx)(s.h2,{id:"general-optimization-form-in-software",children:"General Optimization Form in Software"}),"\n",(0,a.jsx)(s.p,{children:"This software scopes following general optimization form:"}),"\n",(0,a.jsx)(s.span,{className:"katex-display",children:(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsxs)(s.munder,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"min"}),(0,a.jsx)(s.mo,{children:"\u2061"})]}),(0,a.jsx)(s.mi,{mathvariant:"bold-italic",children:"d"})]}),(0,a.jsx)(s.mi,{children:"F"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{mathvariant:"bold-italic",children:"d"}),(0,a.jsx)(s.mo,{separator:"true",children:","}),(0,a.jsx)(s.mi,{mathvariant:"bold-italic",children:"u"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"}),(0,a.jsx)(s.mo,{children:"="}),(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mo,{children:"\u222b"}),(0,a.jsx)(s.mi,{mathvariant:"normal",children:"\u03a9"})]}),(0,a.jsx)(s.mi,{children:"f"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{mathvariant:"bold-italic",children:"d"}),(0,a.jsx)(s.mo,{separator:"true",children:","}),(0,a.jsx)(s.mi,{mathvariant:"bold-italic",children:"u"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"}),(0,a.jsx)(s.mtext,{children:"\xa0"}),(0,a.jsx)(s.mi,{children:"d"}),(0,a.jsx)(s.mi,{children:"V"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\min_{\\bm d} F(\\bm d, \\bm u) = \\int_\\Omega f(\\bm d, \\bm u) \\ dV"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1.5021em",verticalAlign:"-0.7521em"}}),(0,a.jsx)(s.span,{className:"mop op-limits",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,a.jsxs)(s.span,{style:{top:"-2.3479em",marginLeft:"0em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord boldsymbol mtight",children:"d"})})})})})]}),(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{children:(0,a.jsx)(s.span,{className:"mop",children:"min"})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.7521em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord boldsymbol",children:"d"})})}),(0,a.jsx)(s.span,{className:"mpunct",children:","}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord boldsymbol",children:"u"})})}),(0,a.jsx)(s.span,{className:"mclose",children:")"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"="}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"2.2719em",verticalAlign:"-0.9119em"}}),(0,a.jsxs)(s.span,{className:"mop",children:[(0,a.jsx)(s.span,{className:"mop op-symbol large-op",style:{marginRight:"0.44445em",position:"relative",top:"-0.0011em"},children:"\u222b"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"-0.4336em"},children:(0,a.jsxs)(s.span,{style:{top:"-1.7881em",marginLeft:"-0.4445em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:"\u03a9"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.9119em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"f"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord boldsymbol",children:"d"})})}),(0,a.jsx)(s.span,{className:"mpunct",children:","}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord boldsymbol",children:"u"})})}),(0,a.jsx)(s.span,{className:"mclose",children:")"}),(0,a.jsx)(s.span,{className:"mspace",children:"\xa0"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"d"}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.22222em"},children:"V"})]})]})]})}),"\n",(0,a.jsx)(s.span,{className:"katex-display",children:(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"G"}),(0,a.jsx)(s.mi,{children:"j"})]}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{mathvariant:"bold-italic",children:"d"}),(0,a.jsx)(s.mo,{separator:"true",children:","}),(0,a.jsx)(s.mi,{mathvariant:"bold-italic",children:"u"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"}),(0,a.jsx)(s.mo,{children:"\u2264"}),(0,a.jsx)(s.mn,{children:"0"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"G_j(\\bm d, \\bm u) \\leq 0"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1.0361em",verticalAlign:"-0.2861em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",children:"G"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3117em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"},children:"j"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.2861em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord boldsymbol",children:"d"})})}),(0,a.jsx)(s.span,{className:"mpunct",children:","}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord boldsymbol",children:"u"})})}),(0,a.jsx)(s.span,{className:"mclose",children:")"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"\u2264"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6444em"}}),(0,a.jsx)(s.span,{className:"mord",children:"0"})]})]})]})}),"\n",(0,a.jsxs)(s.p,{children:["where ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{mathvariant:"normal",children:"\u03a9"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\Omega"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,a.jsx)(s.span,{className:"mord",children:"\u03a9"})]})})]})," is the design domain and ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{mathvariant:"bold-italic",children:"u"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\bm u"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.4444em"}}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord boldsymbol",children:"u"})})})]})})]})," represents specific fields that satisfy governing equations for any physics defined in ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{mathvariant:"normal",children:"\u03a9"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\Omega"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,a.jsx)(s.span,{className:"mord",children:"\u03a9"})]})})]}),". For example, ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{mathvariant:"bold-italic",children:"u"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\bm u"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.4444em"}}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord boldsymbol",children:"u"})})})]})})]})," is the displacement vector in an elastic deformation problem. ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"F"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"F"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"})]})})]})," is the functional that represents the objective of the optimization. ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{mathvariant:"bold-italic",children:"d"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\bm d"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6944em"}}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord boldsymbol",children:"d"})})})]})})]})," is the design vector, and ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"G"}),(0,a.jsx)(s.mi,{children:"j"})]})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"G_j"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.9694em",verticalAlign:"-0.2861em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",children:"G"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3117em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"},children:"j"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.2861em"},children:(0,a.jsx)(s.span,{})})})]})})]})]})})]})," are the functionals representing the constraints."]}),"\n",(0,a.jsx)(s.h2,{id:"container",children:"Container"}),"\n",(0,a.jsxs)(s.p,{children:["We provide a container for this repository. The container includes python 3.11, FEniCS bundles, and NLOpt with python interface.\r\nThe container is avaiable in ",(0,a.jsx)(s.a,{href:"https://hub.docker.com/repository/docker/ichiharanaruki/pytop/general",children:"dockerhub"}),"."]}),"\n",(0,a.jsx)(s.h2,{id:"installation",children:"Installation"}),"\n",(0,a.jsx)(s.p,{children:"To install Pytop, you need to have Python and FEniCS installed on your system. You can install Pytop via pip:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"pip install git+https://github.com/Naruki-Ichihara/pytop.git@main\n"})}),"\n",(0,a.jsxs)(s.p,{children:["More detailed installation can be found in ",(0,a.jsx)(s.a,{href:"/docs/Getting-started/Installing-pytop",children:"this page"}),"."]}),"\n",(0,a.jsx)(s.h2,{id:"basic-usage",children:"Basic usage"}),"\n",(0,a.jsx)(s.h3,{id:"import-pytop",children:"Import pytop"}),"\n",(0,a.jsxs)(s.p,{children:["First, you need to import ",(0,a.jsx)(s.em,{children:"pytop"})," by standard Python style:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"import pytop as pt\n"})}),"\n",(0,a.jsx)(s.p,{children:"In the header of pytop, all methods and classes of FEniCS will be imported if FEniCS was collectively installed. So, all methods in FEniCS can be called directly like:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:'...\r\nU = pt.FunctionSoace(mesh, "CG", 1)\r\nu = pt.Function(U)\r\n...\n'})}),"\n",(0,a.jsxs)(s.p,{children:["Please refer to the ",(0,a.jsx)(s.a,{href:"https://fenicsproject.org/",children:"FEniCS document"})," to use fundamental functions in FEniCS."]}),"\n",(0,a.jsx)(s.h3,{id:"mesh",children:"Mesh"}),"\n",(0,a.jsxs)(s.p,{children:["Second, you need to generate (or import) mesh. This software provides easy method to import external mesh, ",(0,a.jsx)(s.code,{children:"import_external_mesh"}),". This method use ",(0,a.jsx)(s.code,{children:"meshio"})," in the backgroud, so any mesh type that supported by ",(0,a.jsx)(s.a,{href:"https://github.com/nschloe/meshio",children:"meshio"})," is supported."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"mesh = pt.import_external_mesh(path_to_the_meshfile)\n"})}),"\n",(0,a.jsx)(s.p,{children:"Of course, you can generate mesh by built-in mesh generator in FEniCS like as:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"NUMBER_OF_NODES = (100, 100)\r\nPOSITION = (100, 100)\r\nmesh = pt.RectangleMesh(pt Point(0, 0), pt.Point(*POSITION), *NUMBER_OF_NODES)\n"})}),"\n",(0,a.jsxs)(s.p,{children:["Moreover, we provide simple interface of ",(0,a.jsx)(s.a,{href:"https://github.com/nschloe/pygmsh",children:"pygmsh"}),". pygmsh can generate more flexible geometry, whether 2D or 3D."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"import pytop as pt\r\nimport pygmsh\r\n\r\n...\r\nmesh = pt.from_pygmsh(pyg_mesh)\n"})}),"\n",(0,a.jsx)(s.h3,{id:"function-space-and-function",children:"Function space and Function"}),"\n",(0,a.jsxs)(s.p,{children:["This is standard procedure in the FEniCS. You first need to define ",(0,a.jsx)(s.code,{children:"FunctionSpace"})," and then ",(0,a.jsx)(s.code,{children:"Function"})," (If need, ",(0,a.jsx)(s.code,{children:"TrialFunction"})," and ",(0,a.jsx)(s.code,{children:"TestFunction"}),")."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"U = pt.VectorFunctionSpace(mesh, 'CG', 1) #1st order continuous Galerkin vector space\r\nuh = pf.Function(U, name='displacement)\r\nu = pt.TrialFunction(U)\r\ndu = pt.TestFunction(U)\n"})}),"\n",(0,a.jsx)(s.h3,{id:"boundary-condition",children:"Boundary Condition"}),"\n",(0,a.jsxs)(s.p,{children:["This is also standard procedure in the FEniCS. To define sub-domain of mesh, ",(0,a.jsx)(s.code,{children:"pt.SubDomain"})," class is useful."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"class Left(pt.SubDomain):\r\n    def inside(self, x, on_boundary):\r\n        return x[0] < 1e-6 and on_boundary\r\n\r\nbc = pt.DirichletBC(U, pt.Constant((0, 0)), Left())\n"})}),"\n",(0,a.jsxs)(s.p,{children:["This restricts the left side boundary (x[0] < 1e-6) zero displacement.\r\nTo apply Noiman boundary condition, you can use useful method ",(0,a.jsx)(s.code,{children:"make_noiman_boundary_domains"}),"."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"class Loading(pt.SubDomain):\r\n    def inside(self, x, on_boundary):\r\n        reurn x[0] > 200-1e-6 and 45.0 < x[1] < 55.0 and on_boundary\r\n    \r\nds = pt.make_noiman_boundary_domains(mesh, [Loading()], True)\n"})}),"\n",(0,a.jsxs)(s.p,{children:["This function returns ",(0,a.jsx)(s.code,{children:"Measure"})," class, ",(0,a.jsx)(s.code,{children:"ds"}),"."]}),"\n",(0,a.jsx)(s.h3,{id:"design-variable",children:"Design variable"}),"\n",(0,a.jsxs)(s.p,{children:["You need to define design variable before optimization. The ",(0,a.jsx)(s.code,{children:"DesignVariables"})," class can store multiple design variables with their function space, name, initial value, range, pre/post process, recording path, and recording parameter."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:'X = pt.FunctionSpace(mesh, \'CG\', 1)\r\ndesign_variables = pt.DesignVariables()\r\ndesign_variables.register(X,\r\n                          "parameter_name",\r\n                          [initial value],\r\n                          [range],\r\n                          lambda x: some pre process,\r\n                          lambda x: some post process,\r\n                          "recording_path",\r\n                          recording_interval)\n'})}),"\n",(0,a.jsx)(s.h3,{id:"problem-definition",children:"Problem definition"}),"\n",(0,a.jsxs)(s.p,{children:["The problem statement can be constructed with ",(0,a.jsx)(s.code,{children:"ProblemStatement"}),"."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:'# pytop.physics module includes useful utilities to define physics.\r\nfrom pytop.physics import elasticity as el\r\n\r\nclass Elasticity_Problem(pt.ProblemStatement):\r\n  # objective is abstruct method that must be defined.\r\n\u3000# In this, you need to define physics problem and return evaluation value.\r\n    def objective(self, design_variables): \r\n        self.rho = design_variables["density"] # You need to access design variables through design_variables.\r\n        a = el.linear_2D_elasticity_bilinear_form(u, du, E, nu, penalized_weight(self.rho, eps=1e-4)) # Bilinear form for 2D elastic problem\r\n        L = pt.inner(f, du) * ds(1)  # ds(1) means first subdomain that defined by make_noiman_boundary_domains method.\r\n        pt.solve(a == L, uh, bc)\r\n        return pt.assemble(pt.inner(f, uh) * ds(1))\r\n    # methods that start with "constraint_" is inequality constraint (x<=0).\r\n    def constraint_volume(self, design_variables):\r\n        unitary = pt.project(pt.Constant(1), X)\r\n        return pt.assemble(self.rho*pt.dx)/pt.assemble(unitary*pt.dx) - TARGET_DENSITY\n'})}),"\n",(0,a.jsx)(s.h3,{id:"optimizer",children:"Optimizer"}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.code,{children:"NloptOptimizer"})," will construct NLopt ",(0,a.jsx)(s.code,{children:"opt"})," class with ",(0,a.jsx)(s.code,{children:"DesignVariables"})," and ",(0,a.jsx)(s.code,{children:"ProblemStatement"}),"."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:'opt = pt.NloptOptimizer(design_variables, Problem(), "LD_MMA")\r\n# LD_MMA means Method of moving asymptotes.\n'})}),"\n",(0,a.jsxs)(s.p,{children:["Then you set parameter of optimizer by nlopt optimizer class methods.\r\nPlease refer avaiable method in ",(0,a.jsx)(s.a,{href:"https://nlopt.readthedocs.io/en/latest/NLopt_Python_Reference/",children:"NLopt"}),".\r\nFor example, here we set to maximum iteration number is 300, and relative tolerance is 1e-4:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"opt.set_maxeval(300)\r\nopt.set_ftol_rel(1e-4)\n"})}),"\n",(0,a.jsxs)(s.p,{children:["Then optimization will start by calling ",(0,a.jsx)(s.code,{children:"run"})," method."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"opt.run(path_for_data_logging)\n"})}),"\n",(0,a.jsx)(s.h2,{id:"tips",children:"Tips"}),"\n",(0,a.jsx)(s.h3,{id:"mpi-parallelization",children:"MPI parallelization"}),"\n",(0,a.jsxs)(s.p,{children:["This software is designed as parallelization-ready. Problem is automatically divided into partial problems and computed in each cpus. We provide useful detaclass for MPI, ",(0,a.jsx)(s.code,{children:"MPI_Communicator"}),". You can construct a mpi group use this class,"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"import pytop as pt\r\ncomm_group = pt.MPI_Communicator.comm_world\n"})}),"\n",(0,a.jsxs)(s.p,{children:["Single problem must be in the same group. Then,",(0,a.jsx)(s.code,{children:"mpirun"})," executes the solving with cpus you mentioned:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"mpirun -n 36 python your_problem.py\n"})}),"\n",(0,a.jsx)(s.p,{children:"In the container, you need to give option to allow run as a root user:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"mpirun -n 36 --allow-run-as-root python your_problem.py\n"})}),"\n",(0,a.jsx)(s.p,{children:"Above example use 36 cpus."}),"\n",(0,a.jsx)(s.h3,{id:"working-with-pygmsh",children:"Working with pygmsh"}),"\n",(0,a.jsxs)(s.p,{children:["You can use ",(0,a.jsx)(s.code,{children:"pygmsh"})," as mesh generator.\r\nDocumentation of ",(0,a.jsx)(s.code,{children:"pygmsh"})," is available ",(0,a.jsx)(s.a,{href:"https://pygmsh.readthedocs.io/en/latest/",children:"here"}),"."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"import pytop as pt\r\nimport pygmsh\r\n\r\nwith pygmsh.geo.Geometry() as geom:\r\n    lcar = 0.1\r\n    p1 = geom.add_point([0.0, 0.0], lcar)\r\n    p2 = geom.add_point([1.0, 0.0], lcar)\r\n    p3 = geom.add_point([1.0, 0.5], lcar)\r\n    p4 = geom.add_point([1.0, 1.0], lcar)\r\n    s1 = geom.add_bspline([p1, p2, p3, p4])\r\n\r\n    p2 = geom.add_point([0.0, 1.0], lcar)\r\n    p3 = geom.add_point([0.5, 1.0], lcar)\r\n    s2 = geom.add_spline([p4, p3, p2, p1])\r\n\r\n    ll = geom.add_curve_loop([s1, s2])\r\n    pl = geom.add_plane_surface(ll)\r\n\r\n    mesh = geom.generate_mesh()\r\n\r\nmesh = pt.from_pygmsh(mesh)\n"})}),"\n",(0,a.jsxs)(s.p,{children:["Use ",(0,a.jsx)(s.code,{children:"planation"})," option is used, all ",(0,a.jsx)(s.code,{children:"z"})," coordinates will be neglected."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"mesh = pt.from_pygmsh(mesh, planation=True)\n"})}),"\n",(0,a.jsx)(s.h2,{id:"developer",children:"Developer"}),"\n",(0,a.jsx)(s.h3,{id:"generate-api-documentation",children:"Generate API documentation"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"bash generate_doc.sh\n"})}),"\n",(0,a.jsxs)(s.p,{children:["Above command generates API document using ",(0,a.jsx)(s.a,{href:"https://pdoc3.github.io/pdoc/",children:"pdoc3"}),"."]})]})}function m(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>r});var a=n(6540);const i={},t=a.createContext(i);function l(e){const s=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),a.createElement(t.Provider,{value:s},e.children)}}}]);